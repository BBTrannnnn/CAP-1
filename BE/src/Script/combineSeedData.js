import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const main = () => {
  console.log('üîÑ B∆Ø·ªöC 4: G·ªòP T·∫§T C·∫¢ D·ªÆ LI·ªÜU\n');

  // Load 3 file JSON
  const questionsPath = path.resolve(__dirname, './surveyQuestions.json');
  const templatesPath = path.resolve(__dirname, './habitTemplates.json');
  const suggestionsPath = path.resolve(__dirname, './habitSuggestions.json');

  // Ki·ªÉm tra file t·ªìn t·∫°i
  const missingFiles = [];
  if (!fs.existsSync(questionsPath)) missingFiles.push('surveyQuestions.json');
  if (!fs.existsSync(templatesPath)) missingFiles.push('habitTemplates.json');
  if (!fs.existsSync(suggestionsPath)) missingFiles.push('habitSuggestions.json');

  if (missingFiles.length > 0) {
    console.error('‚ùå Thi·∫øu c√°c file:', missingFiles.join(', '));
    console.log('\n‚ñ∂Ô∏è  Ch·∫°y c√°c script sau:');
    if (missingFiles.includes('surveyQuestions.json')) {
      console.log('   node src/Script/1_generateQuestions.js');
    }
    if (missingFiles.includes('habitTemplates.json')) {
      console.log('   node src/Script/2_generateTemplates.js');
    }
    if (missingFiles.includes('habitSuggestions.json')) {
      console.log('   node src/Script/3_generateSuggestions.js');
    }
    return;
  }

  // Load d·ªØ li·ªáu
  const surveyQuestions = JSON.parse(fs.readFileSync(questionsPath, 'utf-8'));
  const habitTemplates = JSON.parse(fs.readFileSync(templatesPath, 'utf-8'));
  const habitSuggestions = JSON.parse(fs.readFileSync(suggestionsPath, 'utf-8'));

  console.log(`üìã C√¢u h·ªèi: ${surveyQuestions.length}`);
  console.log(`üí° Templates: ${habitTemplates.length}`);
  console.log(`‚ú® Suggestions: ${habitSuggestions.length}\n`);

  // T·∫°o file seedSurvey.js
  const fileContent = `// Auto-generated by generateSeedData.js using Groq API
// DO NOT EDIT MANUALLY - Run generation scripts to regenerate

const surveyQuestions = ${JSON.stringify(surveyQuestions, null, 2)};

const habitTemplates = ${JSON.stringify(habitTemplates, null, 2)};

const habitSuggestions = ${JSON.stringify(habitSuggestions, null, 2)};

const targetPersonas = {
  'health-focused': {
    name: 'Ng∆∞·ªùi t·∫≠p trung s·ª©c kh·ªèe',
    description: '∆Øu ti√™n s·ª©c kh·ªèe th·ªÉ ch·∫•t v√† tinh th·∫ßn',
    categories: ['health', 'fitness', 'sleep', 'mindful']
  },
  'productivity-driven': {
    name: 'Ng∆∞·ªùi nƒÉng su·∫•t cao',
    description: 'T·∫≠p trung v√†o hi·ªáu su·∫•t c√¥ng vi·ªác',
    categories: ['productivity', 'learning', 'energy']
  },
  'knowledge-seeker': {
    name: 'Ng∆∞·ªùi ham h·ªçc h·ªèi',
    description: 'Ph√°t tri·ªÉn b·∫£n th√¢n qua h·ªçc t·∫≠p',
    categories: ['learning', 'productivity']
  },
  'mindful-seeker': {
    name: 'Ng∆∞·ªùi t√¨m ki·∫øm c√¢n b·∫±ng',
    description: 'Quan t√¢m s·ª©c kh·ªèe tinh th·∫ßn',
    categories: ['mindful', 'health', 'sleep']
  },
  'finance-conscious': {
    name: 'Ng∆∞·ªùi c√≥ √Ω th·ª©c t√†i ch√≠nh',
    description: 'Qu·∫£n l√Ω t√†i ch√≠nh t·ªët',
    categories: ['finance']
  },
  'balanced-lifestyle': {
    name: 'Ng∆∞·ªùi s·ªëng c√¢n b·∫±ng',
    description: 'C√¢n b·∫±ng c√¥ng vi·ªác v√† cu·ªôc s·ªëng',
    categories: ['health', 'productivity', 'social', 'mindful']
  },
  'fitness-enthusiast': {
    name: 'Ng∆∞·ªùi ƒëam m√™ th·ªÉ h√¨nh',
    description: 'T·∫≠p trung t·∫≠p luy·ªán',
    categories: ['fitness', 'health']
  },
  'social-connector': {
    name: 'Ng∆∞·ªùi quan h·ªá x√£ h·ªôi',
    description: 'Coi tr·ªçng m·ªëi quan h·ªá',
    categories: ['social']
  }
};

export {
  surveyQuestions,
  habitSuggestions,
  habitTemplates,
  targetPersonas
};
`;

  // L∆∞u file
  const outputPath = path.resolve(__dirname, './seedSurvey.js');
  fs.writeFileSync(outputPath, fileContent);

  console.log('='.repeat(60));
  console.log('üéâ HO√ÄN T·∫§T G·ªòP D·ªÆ LI·ªÜU!');
  console.log('='.repeat(60));
  console.log(`üíæ ƒê√£ t·∫°o file: ${outputPath}`);
  console.log(`\nüìä Th·ªëng k√™:`);
  console.log(`   - ${surveyQuestions.length} c√¢u h·ªèi kh·∫£o s√°t`);
  console.log(`   - ${habitTemplates.length} m·∫´u th√≥i quen`);
  console.log(`   - ${habitSuggestions.length} g·ª£i √Ω th√≥i quen`);
  console.log(`\n‚ñ∂Ô∏è  Ch·∫°y seed v√†o database:`);
  console.log(`   node src/Script/seed.js`);
  console.log('='.repeat(60));
};

main();